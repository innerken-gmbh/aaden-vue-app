{"version":3,"sources":["webpack:///./src/views/dishes/DThresholdColorSetting.vue?e4ac","webpack:///./src/model/DThresholdColorSetting.js","webpack:///src/views/dishes/DThresholdColorSetting.vue","webpack:///./src/views/dishes/DThresholdColorSetting.vue?cecd","webpack:///./src/views/dishes/DThresholdColorSetting.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","ref","attrs","model","$t","scopedSlots","_u","key","fn","staticClass","on","reset","_v","_s","proxy","staticRenderFns","entity","id","type","IKDataEntity","Types","Integer","displayName","tableConfig","align","form","ratio","formConfig","required","overwriteRule","color","Color","config","add","item","sortedArray","hillo","get","op","tempList","content","console","log","length","sort","obj1","obj2","val1","maxRatio","val2","parseFloat","_","findIndex","o","Ratio","slice","colorIndex","minRatio","postWithUploadFile","showLoading","edit","remove","_data","_item","find","i","JSON","stringify","backItem","frontItem","post","load","filter","tempItem","getSortedColorList","resetColorList","IKUtils","toast","ModelFactory","components","IkDataTable","data","methods","component","VBtn"],"mappings":"uHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACA,EAAG,gBAAgB,CAACE,IAAI,iBAAiBC,MAAM,CAAC,MAAQP,EAAIQ,MAAM,cAAcR,EAAIS,GAAG,QAAQ,KAAO,aAAaC,YAAYV,EAAIW,GAAG,CAAC,CAACC,IAAI,SAASC,GAAG,WAAW,MAAO,CAACT,EAAG,QAAQ,CAACU,YAAY,WAAWC,GAAG,CAAC,MAAQf,EAAIgB,QAAQ,CAAChB,EAAIiB,GAAG,IAAIjB,EAAIkB,GAAGlB,EAAIS,GAAG,WAAW,SAASU,OAAM,QAAW,IAC3YC,EAAkB,G,0LCIhBC,EAAS,CACbC,GAAI,CACFC,KAAMC,kBAAaC,MAAMC,QACzBC,YAAa,KACbC,YAAa,CACXC,MAAO,SAETC,MAAM,GAGRC,MAAO,CACLJ,YAAa,QACbK,WAAY,CACVC,UAAU,EACVC,eAAe,GAEjBJ,MAAM,GA0BRK,MAAO,CACLZ,KAAMC,kBAAaC,MAAMW,MACzBJ,WAAY,CACVC,UAAU,KAMVI,EAAS,CAEbC,IAAK,WAAF,4CAAE,WAAgBC,GAAhB,gGAICC,EAAc,GAJf,SAKqBC,IAAMC,IAAI,aAAc,CAC9CC,GAAI,oBANH,UAKGC,EALH,OAQAC,QAWHC,QAAQC,IAAI,aAAcH,KAEtBA,EAASI,QAAU,GArBpB,yCAqB8B,IArB9B,OAuBCF,QAAQC,IAAI,uBAAwBH,GACpCJ,EAAcI,EAASK,MAAK,SAAUC,EAAMC,GAC5C,IAAMC,EAAOF,EAAKG,SACZC,EAAOH,EAAKE,SAElB,OAAKC,GAAQC,WAAWH,GAAQG,WAAWD,IAAe,GAEhDF,GAAQG,WAAWH,GAAQG,WAAWD,GAAc,EAClD,KAEdR,QAAQC,IAAI,sBAAuBP,GAjClC,aAqCCgB,IAAEC,UAAUjB,GAAa,SAAUkB,GAAK,OAAOA,EAAEL,WAAad,EAAKoB,UAAY,GArChF,wBAsCDb,QAAQC,IAAI,qBAtCX,mBAuCQ,GAvCR,eAyCDD,QAAQC,IAAI,kBAAmBS,IAAEI,MAAMpB,EAAa,EAAGA,EAAYQ,OAAS,IACtEa,EAAaL,IAAEC,UAAUD,IAAEI,MAAMpB,EAAa,EAAGA,EAAYQ,OAAS,IAC1E,SAAUU,GACR,OAAOA,EAAEL,SAAWd,EAAKoB,SAG7Bb,QAAQC,IAAI,aAAcc,GAEtBA,IAAe,GACjBtB,EAAKuB,SAAW,KAChBvB,EAAKc,SAAWd,EAAKoB,MAErBnB,EAAY,GAAGsB,SAAWvB,EAAKoB,MAE/Bb,QAAQC,IAAI,kBAAmBR,GAC/BE,IAAMsB,mBAAmB,kCAAmCvB,EAAY,GAAI,CAC1EwB,aAAa,MAGfzB,EAAKuB,SAAWtB,EAAYqB,GAAYR,SACxCd,EAAKc,SAAWd,EAAKoB,MAErBnB,EAAYqB,EAAa,GAAGC,SAAWvB,EAAKoB,MAE5ClB,IAAMsB,mBAAmB,kCAAmCvB,EAAYqB,GAAa,CACnFG,aAAa,IAEfvB,IAAMsB,mBAAmB,kCAAmCvB,EAAYqB,EAAa,GAAI,CACvFG,aAAa,KAIjBvB,IAAMsB,mBAAmB,kCAAmCxB,EAAM,CAChEyB,aAAa,IA1Ed,mBA4EM,GA5EN,4CAAF,sDAAE,GAgFLC,KAAM,SAAU1B,GAMd,MALmB,UAAfA,EAAKoB,MACPpB,EAAKc,SAAW,KAEhBd,EAAKc,SAAWd,EAAKoB,MAEhBlB,IAAMsB,mBAAmB,kCAAmCxB,EAAM,CACvEyB,aAAa,KAIjBE,OAAQ,WAAF,4CAAE,WAAgB5C,GAAhB,2GACemB,IAAMC,IAAI,aAAc,CAC3CC,GAAI,oBAFA,cACAwB,EADA,OAIHtB,QAEGuB,EAAQD,EAAME,MAAK,SAAAC,GAAC,OAAIA,EAAEhD,KAAOiD,KAAKC,UAAUlD,MAEjD8C,EAAMf,UAOHoB,EAAWN,EAAME,MAAK,SAAAC,GAAC,OAAIA,EAAER,WAAaM,EAAMf,YACtDoB,EAASX,SAAWM,EAAMN,SAC1BrB,IAAMsB,mBAAmB,kCAAmCU,EAAU,CACpET,aAAa,MATTU,EAAYP,EAAME,MAAK,SAAAC,GAAC,OAAIA,EAAEjB,WAAae,EAAMN,YACvDY,EAAUrB,SAAW,KACrBZ,IAAMsB,mBAAmB,kCAAmCW,EAAW,CACrEV,aAAa,KASjBvB,IAAMkC,KAAK,kCAAmC,CAAErD,GAAIA,IArB9C,mBAsBC,GAtBD,2CAAF,sDAAE,GAyBRsD,KAAM,WAAF,4CAAE,WAAgBC,GAAhB,yGACiBpC,IAAMC,IAAI,aAAV,gBACnBC,GAAI,mBACDkC,IAHD,OAUJ,GATMV,EADF,OAKDtB,QAEHC,QAAQC,IAAI,WAAYoB,GACpBW,EAAW,KAEXX,EAAMnB,QAAU,EAClBP,IAAMsB,mBAAmB,kCAAmC,CAC1DD,SAAU,KACVT,SAAU,EACVM,MAAO,EACPxB,MAAO,WACR,CAAE6B,aAAa,IAEhBvB,IAAMsB,mBAAmB,kCAAmC,CAC1DD,SAAU,EACVT,SAAU,KACVM,MAAO,QACPxB,MAAO,WACN,CAAE6B,aAAa,SACb,GAAqB,IAAjBG,EAAMnB,OAEf8B,EAAWX,EAAM,GAEZW,EAAShB,SAOFgB,EAASzB,UAQnBZ,IAAMsB,mBAAmB,kCAAmC,CAC1DD,SAAUgB,EAASzB,SACnBA,SAAU,KACVM,MAAO,QACPxB,MAAO,WACN,CAAE6B,aAAa,IAElBvB,IAAMsB,mBAAmB,kCAAmC,CAC1DD,SAAU,KACVT,SAAUyB,EAAShB,SACnBH,MAAO,QACPxB,MAAO,WACN,CAAE6B,aAAa,KAnBlBvB,IAAMsB,mBAAmB,kCAAmC,CAC1DD,SAAU,KACVT,SAAUyB,EAAShB,SACnBH,MAAO,QACPxB,MAAO,WACN,CAAE6B,aAAa,IAZlBvB,IAAMsB,mBAAmB,kCAAmC,CAC1DD,SAAUgB,EAASzB,SACnBA,SAAU,KACVM,MAAO,QACPxB,MAAO,WACN,CAAE6B,aAAa,SAyBpB,IAAWM,KADXQ,EAAWX,EACKW,EACTA,EAASR,GAAGjB,SAEVyB,EAASR,GAAGX,MAAQmB,EAASR,GAAGjB,SADrCyB,EAASR,GAAGX,MAAQ,QA7DtB,OAkEJb,QAAQC,IAAI,gBAAiB+B,GAlEzB,kBAmEGA,GAnEH,2CAAF,sDAAE,GAsENC,mBAAoB,WAAF,4CAAE,oHACMtC,IAAMC,IAAI,aAAc,CAC9CC,GAAI,oBAFY,UACZC,EADY,OAIfC,UAECD,EAASI,QAAU,GANL,yCAMe,IANf,cAQVR,EAAcI,EAASK,MAAK,SAAUC,EAAMC,GAChD,IAAMC,EAAOF,EAAKG,SACZC,EAAOH,EAAKE,SAElB,OAAMC,GAAQF,EAAOE,GAAc,EAExBF,GAAQA,EAAOE,EAAa,EAC3B,KAGdR,QAAQC,IAAI,gBAAiBH,GAlBb,kBAmBTJ,GAnBS,4CAAF,qDAAE,GAuBpBwC,eAAgB,WAAF,4CAAE,wHACUvC,IAAMC,IAAI,aAAc,CAC9CC,GAAI,oBAFQ,OACRC,EADQ,OAIXC,QAEHoC,IAAQjB,aAAY,GANN,iBAQKpB,GARL,IAQd,IAAK,EAAL,qBAAWL,EAAkB,QAC3BE,IAAMkC,KAAK,kCAAmC,CAAErD,GAAIiB,EAAKjB,KAT7C,8BAYdmB,IAAMsB,mBAAmB,kCAAmC,CAC1DD,SAAU,KACVT,SAAU,EACVM,MAAO,EACPxB,MAAO,WACN,IAEHM,IAAMsB,mBAAmB,kCAAmC,CAC1DD,SAAU,EACVT,SAAU,KACVM,MAAO,QACPxB,MAAO,WACN,IAEH8C,IAAQC,MAAM,MA1BA,2CAAF,qDAAE,IA+BH1D,oBAAa2D,aAAa9D,EAAQgB,GClRjD,GAEA+C,YACAC,8BAEAC,gBACA,OACA9E,UAGA+E,SACAvE,MADA,WACA,oKACA,yBADA,OAEA,gCAFA,gDCnC+W,I,6CCO3WwE,EAAY,eACd,EACAzF,EACAqB,GACA,EACA,KACA,WACA,MAIa,aAAAoE,EAAiB,QAKhC,IAAkBA,EAAW,CAACC,OAAA","file":"js/chunk-2d0abc56.03ce113c.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('ik-data-table',{ref:\"thresholdColor\",attrs:{\"model\":_vm.model,\"entity-name\":_vm.$t('阈值颜色'),\"icon\":'mdi-heart'},scopedSlots:_vm._u([{key:\"footer\",fn:function(){return [_c('v-btn',{staticClass:\"red ml-2\",on:{\"click\":_vm.reset}},[_vm._v(\" \"+_vm._s(_vm.$t('重置菜品阈值'))+\" \")])]},proxy:true}])})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { IKDataEntity } from 'metaflow-js'\nimport hillo from 'hillo'\nimport _ from 'lodash'\nimport IKUtils from 'innerken-js-utils'\n\nconst entity = {\n  id: {\n    type: IKDataEntity.Types.Integer,\n    displayName: 'id',\n    tableConfig: {\n      align: 'start',\n    },\n    form: false,\n  },\n\n  ratio: {\n    displayName: 'ratio',\n    formConfig: {\n      required: true,\n      overwriteRule: false,\n    },\n    form: false,\n  },\n\n  // minRatio: {\n  //   displayName: 'minRatio',\n  //   formConfig: {\n  //     overwriteRule: false,\n  //     rule: [\n  //       // v => /^(-)?[0-9]+\\.{0,1}[0-9]{0,2}$/.test(v) || 'please enter the correct min Ratio',\n  //       v => (!isNaN(parseFloat(v)) && parseFloat(v) > 0) || 'The min Ratio should be greater than 0',\n  //     ],\n  //     required: false,\n  //   },\n  // },\n  //\n  // maxRatio: {\n  //   displayName: 'maxRatio',\n  //   formConfig: {\n  //     overwriteRule: true,\n  //     rule: [\n  //       // v => (!isNaN(parseFloat(v)) && parseFloat(v) >= 0) || 'The max Ratio could not be negative',\n  //     ],\n  //     required: false,\n  //   },\n  // },\n\n  color: {\n    type: IKDataEntity.Types.Color,\n    formConfig: {\n      required: true,\n    },\n  },\n\n}\n\nconst config = {\n\n  add: async function (item) {\n    // console.log('add item', item)\n    // const sortedArray = this.getSortedColorList()\n    // console.log('sortedArray before', sortedArray)\n    let sortedArray = []\n    const tempList = (await hillo.get('DCache.php', {\n      op: 'showDCacheColor',\n    }))\n      .content\n\n    // let frontItem = tempList[0]\n    // tempList.forEach(function (value, index, array) {\n    //   if (!value.maxRatio) {\n    //     backItem = value\n    //   }\n    //   value.maxRatio < item.Ratio\n    //   frontItem = value\n    // })\n\n    console.log('tempList 1', tempList)\n\n    if (tempList.length <= 0) return []\n    else {\n        console.log('sortedArray 2 before', tempList)\n        sortedArray = tempList.sort(function (obj1, obj2) {\n        const val1 = obj1.maxRatio\n        const val2 = obj2.maxRatio\n        // val2 is null, that means val2 is infinity\n        if (!val2 || parseFloat(val1) < parseFloat(val2)) return -1\n        // val1 is null, that means val1 is infinity\n        else if (!val1 || parseFloat(val1) > parseFloat(val2)) return 1\n        else return 0\n      })\n      console.log('sortedArray 3 after', sortedArray)\n    }\n\n    // if colorList is empty, we will get two item for top-Ratio and bottom-Ration\n    if (_.findIndex(sortedArray, function (o) { return o.maxRatio === item.Ratio }) >= 0) {\n      console.log('they are the same')\n        return true\n    } else {\n      console.log('sorted -1 Array', _.slice(sortedArray, 0, sortedArray.length - 1))\n      const colorIndex = _.findIndex(_.slice(sortedArray, 0, sortedArray.length - 1),\n        function (o) {\n          return o.maxRatio < item.Ratio\n        })\n\n      console.log('colorIndex', colorIndex)\n\n      if (colorIndex <= -1) {\n        item.minRatio = null\n        item.maxRatio = item.Ratio\n\n        sortedArray[0].minRatio = item.Ratio\n\n        console.log('colorIndex item', item)\n        hillo.postWithUploadFile('DCache.php?op=updateDCacheColor', sortedArray[0], {\n          showLoading: true,\n        })\n      } else {\n        item.minRatio = sortedArray[colorIndex].maxRatio\n        item.maxRatio = item.Ratio\n\n        sortedArray[colorIndex + 1].minRatio = item.Ratio\n\n        hillo.postWithUploadFile('DCache.php?op=updateDCacheColor', sortedArray[colorIndex], {\n          showLoading: true,\n        })\n        hillo.postWithUploadFile('DCache.php?op=updateDCacheColor', sortedArray[colorIndex + 1], {\n          showLoading: true,\n        })\n      }\n\n      hillo.postWithUploadFile('DCache.php?op=createDCacheColor', item, {\n        showLoading: true,\n      })\n      return true\n    }\n  },\n\n  edit: function (item) {\n    if (item.Ratio === '+Infi') {\n      item.maxRatio = null\n    } else {\n      item.maxRatio = item.Ratio\n    }\n    return hillo.postWithUploadFile('DCache.php?op=updateDCacheColor', item, {\n      showLoading: true,\n    })\n  },\n\n  remove: async function (id) {\n    const _data = (await hillo.get('DCache.php', {\n      op: 'showDCacheColor',\n    }))\n      .content\n\n    const _item = _data.find(i => i.id === JSON.stringify(id))\n\n    if (!_item.maxRatio) {\n      const frontItem = _data.find(i => i.maxRatio === _item.minRatio)\n      frontItem.maxRatio = null\n      hillo.postWithUploadFile('DCache.php?op=updateDCacheColor', frontItem, {\n        showLoading: true,\n      })\n    } else {\n      const backItem = _data.find(i => i.minRatio === _item.maxRatio)\n      backItem.minRatio = _item.minRatio\n      hillo.postWithUploadFile('DCache.php?op=updateDCacheColor', backItem, {\n        showLoading: true,\n      })\n    }\n    hillo.post('DCache.php?op=deleteDCacheColor', { id: id })\n    return true\n  },\n\n  load: async function (filter) {\n    const _data = (await hillo.get('DCache.php', {\n      op: 'showDCacheColor',\n      ...filter,\n    }))\n      .content\n\n    console.log('tempItem', _data)\n    let tempItem = null\n\n    if (_data.length <= 0) {\n      hillo.postWithUploadFile('DCache.php?op=createDCacheColor', {\n        minRatio: null,\n        maxRatio: 1,\n        Ratio: 1,\n        color: '#E57373',\n    }, { showLoading: true })\n\n      hillo.postWithUploadFile('DCache.php?op=createDCacheColor', {\n        minRatio: 1,\n        maxRatio: null,\n        Ratio: '+Infi',\n        color: '#A5D6A7',\n      }, { showLoading: true })\n    } else if (_data.length === 1) {\n      // if(tempItem[0].maxRatio && )\n      tempItem = _data[0]\n\n      if (!tempItem.minRatio) {\n        hillo.postWithUploadFile('DCache.php?op=createDCacheColor', {\n          minRatio: tempItem.maxRatio,\n          maxRatio: null,\n          Ratio: '+Infi',\n          color: '#A5D6A7',\n        }, { showLoading: true })\n      } else if (!tempItem.maxRatio) {\n        hillo.postWithUploadFile('DCache.php?op=createDCacheColor', {\n          minRatio: null,\n          maxRatio: tempItem.minRatio,\n          Ratio: '-Infi',\n          color: '#E57373',\n        }, { showLoading: true })\n      } else {\n        hillo.postWithUploadFile('DCache.php?op=createDCacheColor', {\n          minRatio: tempItem.maxRatio,\n          maxRatio: null,\n          Ratio: '+Infi',\n          color: '#A5D6A7',\n        }, { showLoading: true })\n\n        hillo.postWithUploadFile('DCache.php?op=createDCacheColor', {\n          minRatio: null,\n          maxRatio: tempItem.minRatio,\n          Ratio: '-Infi',\n          color: '#E57373',\n        }, { showLoading: true })\n      }\n    } else {\n      tempItem = _data\n      for (const i in tempItem) {\n        if (!tempItem[i].maxRatio) {\n          tempItem[i].Ratio = '+Infi'\n        } else tempItem[i].Ratio = tempItem[i].maxRatio\n      }\n    }\n\n    console.log('load tempItem', tempItem)\n    return tempItem\n  },\n\n  getSortedColorList: async function () {\n    const tempList = (await hillo.get('DCache.php', {\n      op: 'showDCacheColor',\n    }))\n      .content\n\n    if (tempList.length <= 0) return []\n    else {\n      const sortedArray = tempList.sort(function (obj1, obj2) {\n        const val1 = obj1.maxRatio\n        const val2 = obj2.maxRatio\n        // val2 is null, that means val2 is infinity\n        if (!!val2 && val1 < val2) return -1\n        // val1 is null, that means val1 is infinity\n        else if (!!val1 && val1 > val2) return 1\n        else return 0\n      })\n\n      console.log('getSortedList', tempList)\n      return sortedArray\n    }\n  },\n\n  resetColorList: async function () {\n    const tempList = (await hillo.get('DCache.php', {\n      op: 'showDCacheColor',\n    }))\n      .content\n\n    IKUtils.showLoading(true)\n\n    for (const item of tempList) {\n      hillo.post('DCache.php?op=deleteDCacheColor', { id: item.id })\n    }\n\n    hillo.postWithUploadFile('DCache.php?op=createDCacheColor', {\n      minRatio: null,\n      maxRatio: 1,\n      Ratio: 1,\n      color: '#E57373',\n    }, { })\n\n    hillo.postWithUploadFile('DCache.php?op=createDCacheColor', {\n      minRatio: 1,\n      maxRatio: null,\n      Ratio: '+Infi',\n      color: '#A5D6A7',\n    }, { })\n\n    IKUtils.toast('OK')\n  },\n\n}\n\nexport default IKDataEntity.ModelFactory(entity, config)\n","<template>\n  <div>\n    <ik-data-table\n      ref=\"thresholdColor\"\n      :model=\"model\"\n      :entity-name=\"$t('阈值颜色')\"\n      :icon=\"'mdi-heart'\"\n    >\n      <template v-slot:footer>\n        <v-btn\n          class=\"red ml-2\"\n          @click=\"reset\"\n        >\n          {{ $t('重置菜品阈值') }}\n        </v-btn>\n      </template>\n    </ik-data-table>\n  </div>\n</template>\n\n<script>\n  import { IkDataTable } from 'metaflow-js'\n  import DThresholdColorSetting from '../../model/DThresholdColorSetting'\n\n  export default {\n\n    components: {\n      IkDataTable,\n    },\n    data: function () {\n      return ({\n        model: DThresholdColorSetting,\n      })\n    },\n    methods: {\n      async reset () {\n        await this.model.resetColorList()\n        this.$refs.thresholdColor.reload()\n      },\n    },\n  }\n</script>\n\n<style scoped>\n\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DThresholdColorSetting.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DThresholdColorSetting.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./DThresholdColorSetting.vue?vue&type=template&id=35dfe1ad&scoped=true&\"\nimport script from \"./DThresholdColorSetting.vue?vue&type=script&lang=js&\"\nexport * from \"./DThresholdColorSetting.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"35dfe1ad\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\ninstallComponents(component, {VBtn})\n"],"sourceRoot":""}